<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.6" />
<title></title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="paragraph"><p>In Day 7 you should have seen:</p></div>
<div class="ulist"><ul>
<li>
<p>
A few basic ideas of OOP
</p>
</li>
<li>
<p>
What a minimal ScriptDev2 script looks like, and how it is added to the system
</p>
</li>
</ul></div>
<div class="paragraph"><p>This day is now about</p></div>
<div class="ulist"><ul>
<li>
<p>
A description about the main classes used for boss scripts in ScriptDev2
</p>
</li>
<li>
<p>
A few things you can do with the provided powers
</p>
</li>
</ul></div>
<div class="sect1">
<h2 id="_first_part">1. First Part</h2>
<div class="sectionbody">
<div class="paragraph"><p>Interaction between MaNGOS and ScriptDev2 for Creature AIs</p></div>
<div class="sect2">
<h3 id="_the_creatureai_class">1.1. The CreatureAI class</h3>
<div class="paragraph"><p>The class <em>CreatureAI</em> defined in MaNGOS, especially in <tt>src/game/CreatureAI.h</tt> is the topmost class for any AI a creature uses.
Any npc in the world has one AI, and this AI is a subclass of CreatureAI.</p></div>
<div class="paragraph"><p>The AI of any Creature can be accessed by the member function of the Creature class named <tt>AI()</tt>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content"><a href="https://github.com/mangos/mangos/blob/master/src/game/CreatureAI.h">The MaNGOS CreatureAI header</a></td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">TODO Link here to auto-generated documentation</td>
</tr></table>
</div>
<div class="paragraph"><p>When you look into the source, you will notice that nearly all of the functions are marked <em>virtual</em>
This means, that when anywhere in the core one of these functions is called the implementation of this function in the actual class realising the AI will be called.</p></div>
<div class="paragraph"><p>This is the way how the script is "informed" about events that it might want to react to.</p></div>
<div class="paragraph"><p>When the core will call these functions is documented there.</p></div>
</div>
<div class="sect2">
<h3 id="_the_scriptedai_class">1.2. The ScriptedAI class</h3>
<div class="paragraph"><p>The class <em>ScriptedAI</em> is the base class in ScriptDev2 to be used to implement scripts.
It implements a few of the functions of CreatureAI with default behaviour you might expect from a creature.</p></div>
<div class="paragraph"><p>What are the actual default implementations of ScriptedAI can be seen in <tt>include/sc_creature.cpp</tt>:</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content"><a href="https://github.com/scriptdev2/scriptdev2/blob/master/include/sc_creature.cpp">Basic ScriptDev2 class for creature scripts</a></td>
</tr></table>
</div>
<div class="paragraph"><p>When we implement a boss script, we usally overwrite a few functions of ScriptedAI (and hence overwrite the functions of CreatureAI).</p></div>
</div>
<div class="sect2">
<h3 id="_our_example_class_em_boss_festergutai_em">1.3. Our example class <em>boss_festergutAI</em></h3>
<div class="paragraph"><p>As you should remember from Day 7 that <em>boss_festergutAI</em> is a subclass of <em>ScriptedAI</em>, which is a subclass of <em>CreatureAI</em>.</p></div>
<div class="paragraph"><p>Currently, this class does not do very much, and hence also the instances of the class assigned to a spawned creature is also rather boring.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_end_of_first_part">2. End of first part</h2>
<div class="sectionbody">
<div class="paragraph"><p>This already brings us to the end of the small introduction of the CreatureAI functions.
This got way shorter than intended, and must be improved.</p></div>
<div class="paragraph"><p>The main problem here is how to bring a relatively big class with a fair amount of documentation into a usable format for this guide.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/example.png" alt="Exercise" />
</td>
<td class="content">
<div class="title"><strong>Exercise 1</strong> - Do my job :)</div>
<div class="paragraph"><p>Do look into the CreatureAI class, and think if there might be ways to present it in a guide environment!</p></div>
</td>
</tr></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_second_part">3. Second Part:</h2>
<div class="sectionbody">
<div class="paragraph"><p>As just noted, the script we added to boss Festergut with the class <em>boss_festergutAI</em> is really really boring, so now we start to change it!</p></div>
<div class="paragraph"><p>In this part we will cover a few of the virtual functions we have available through <em>CreatureAI</em> to do some text output.</p></div>
<div class="sect2">
<h3 id="_text_output_in_scriptdev2">3.1. Text Output in ScriptDev2</h3>
<div class="paragraph"><p>Luckily most of the texts in ICC are already prepared for ScriptDev2, so we can use them very easy.
They might not be all correct, and it will become required to change some of them to make them better.
Currently they are taken from <a href="http://www.wowwiki.com">wowwiki</a>, which is a good source but not always perfect.</p></div>
<div class="sect3">
<h4 id="_the_signature_of_a_function">3.1.1. The signature of a function</h4>
<div class="paragraph"><p>Any function defined in C++ has a so called signature.
This is the combination of:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
return-type
</dt>
<dd>
<p>
The type of the values returned by the function
</p>
</dd>
<dt class="hdlist1">
function-name
</dt>
<dd>
<p>
The name of the function (in case of C++ case sensetive)
</p>
</dd>
<dt class="hdlist1">
paramter-list
</dt>
<dd>
<p>
The parameter types the function takes
</p>
</dd>
</dl></div>
</div>
</div>
<div class="sect2">
<h3 id="_doscripttext">3.2. DoScriptText</h3>
<div class="paragraph"><p>Our main method to output text is <tt>DoScriptText</tt> which is defined in <tt>ScriptMgr.cpp</tt>, its signature looks like this:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>void DoScriptText(int32 iTextEntry, WorldObject* pSource, Unit* pTarget /*=NULL*/)</tt></pre>
</div></div>
<div class="paragraph"><p>Where the parameters have this meaning:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>iTextEntry</strong>(an int32 number)
</dt>
<dd>
<p>
Entry of the text, stored in SD2-database
</p>
</dd>
<dt class="hdlist1">
<strong>pSource</strong>(a WorldObject, often a Creature)
</dt>
<dd>
<p>
Who displays the text
</p>
</dd>
<dt class="hdlist1">
<strong>pTarget</strong>(a Unit, that is player or creature)
</dt>
<dd>
<p>
To whom the text will be directed, <em>not</em> required
</p>
</dd>
</dl></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">A detailed description of how SD2 stores the texts in the database can be found in <a href="http://www.scriptdev2.com/showthread.php?t=5536">Guide for SD2-SQL</a></td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_doing_text_on_aggro">3.3. Doing Text on Aggro</h3>
<div class="paragraph"><p>Most bosses have a text when they start attacking, this we call <em>Aggro</em> for which a function in ScriptedAI is defined, with the signature</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>void Aggro(Unit* pWho)</tt></pre>
</div></div>
<div class="dlist"><dl>
<dt class="hdlist1">
pWho
</dt>
<dd>
<p>
is the Unit (Player or Creature) whom we aggro.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>This we will now overwrite, to display the text "Fun time!" by Festergut when Festergut aggroes.</p></div>
<div class="paragraph"><p>This text is already in the SD2 database, and the number is assigned the constant <tt>SAY_AGGRO</tt>.</p></div>
<div class="paragraph"><p>The required change looks like this:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>From f5f3a22fec940bdf0b4a20fc6f8c09859af97609 Mon Sep 17 00:00:00 2001
From: Schmoozerd &lt;schmoozerd@scriptdev2.com&gt;
Date: Sat, 15 Oct 2011 01:31:06 +0200
Subject: [PATCH] ICC, Festergut - Add Aggro text

---
 .../icecrown_citadel/boss_festergut.cpp            |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/scripts/northrend/icecrown_citadel/icecrown_citadel/boss_festergut.cpp b/scripts/northrend/icecrown_citadel/icecrown_citadel/boss_festergut.cpp
index acd358d..940b7f7 100644
--- a/scripts/northrend/icecrown_citadel/icecrown_citadel/boss_festergut.cpp
+++ b/scripts/northrend/icecrown_citadel/icecrown_citadel/boss_festergut.cpp
@@ -48,6 +48,11 @@ struct MANGOS_DLL_DECL boss_festergutAI : public ScriptedAI
     void Reset()
     {
     }
+
+    void Aggro(Unit* pWho)                         <img src="./images/icons/callouts/1.png" alt="1" />
+    {
+        DoScriptText(SAY_AGGRO, m_creature);
+    }
 };

 CreatureAI* GetAI_boss_festergut(Creature* pCreature)
--
1.7.6.msysgit.0</tt></pre>
</div></div>
<div class="paragraph"><p>Where</p></div>
<div class="colist arabic"><table>
<tr><td><img src="./images/icons/callouts/1.png" alt="1" /></td><td>
The actual changes to the code
</td></tr>
</table></div>
<div class="paragraph"><p>Remark that the variable <tt>m_creature</tt> links to Festergut.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/example.png" alt="Exercise" />
</td>
<td class="content">
<div class="title"><strong>Exercise 2</strong> - Where is it from</div>
<div class="paragraph"><p>Where is the variable m_creature defined?</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_doing_text_when_killing_a_player">3.4. Doing Text when killing a player</h3>
<div class="paragraph"><p>This is very important text, because a both where this doesn&#8217;t happen should not be called boss :)
Only killed players are good players!</p></div>
<div class="paragraph"><p>Looking again into CreatureAI you can find:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>        /**
         * Called when the creature kills a unit
         * @param pVictim Victim that got killed
         */
        virtual void KilledUnit(Unit* pVictim) {}</tt></pre>
</div></div>
<div class="paragraph"><p>As Player is a subclass of Unit, a player is also a unit, so this function can be expected to be called when the creature kills a player.
This is infact true, so we will use this function to display the text we want to display when killing enemies.</p></div>
<div class="paragraph"><p>From <a href="http://www.wowwiki.com/Festergut">wowwiki</a> we take the texts "Daddy, I did it!" and "Dead, dead, dead!" which should be displayed when killing.
There are already two constants assinged: <tt>SAY_SLAY_1</tt> and <tt>SAY_SLAY_2</tt>.</p></div>
<div class="paragraph"><p>The required code to overwrite the function "void KilledUnit(Unit* pVictim)" is:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>    void KilledUnit(Unit* pVictim)
    {
        DoScriptText(urand(0, 1) ? SAY_SLAY_1 : SAY_SLAY_2, m_creature);
    }</tt></pre>
</div></div>
<div class="paragraph"><p>The full changeset can be seen on <a href="https://github.com/scriptdev2/scriptdev2/commit/7a35df04b072ebbeb038235e0b6d6b68a91ab81b">Github</a> or on <a href="https://github.com/scriptdev2/scriptdev2/commit/7a35df04b072ebbeb038235e0b6d6b68a91ab81b.patch">Github as format-patch</a></p></div>
<div class="paragraph"><p>In case you have never seen this construction before:</p></div>
<div class="paragraph"><p>With <tt>expression ? A : B</tt> you tell the code to set at this place IF expression is true THEN A ELSE B, which is handy to write compact code.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/example.png" alt="Exercise" />
</td>
<td class="content">
<div class="title"><strong>Exercise 3</strong> - More texts</div>
<div class="paragraph"><p>Find a function that could be used when a creature just died, and use it to display the text of constant <tt>SAY_DEATH</tt></p></div>
</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_end_of_second_part">4. End of second part</h2>
<div class="sectionbody">
<div class="paragraph"><p>What you should have seen today:</p></div>
<div class="ulist"><ul>
<li>
<p>
Where the functions you can use in ScriptDev2 boss scripts come from
</p>
</li>
<li>
<p>
How to use them to display some texts
</p>
</li>
</ul></div>
<div class="paragraph"><p>What comes next:</p></div>
<div class="ulist"><ul>
<li>
<p>
The UpdateAI function, and timers
</p>
</li>
<li>
<p>
Some more constructs to make a boss deadly
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/example.png" alt="Exercise" />
</td>
<td class="content">
<div class="title"><strong>Exercise 4</strong> - Prepare yourself</div>
<div class="paragraph"><p>Figure out how UpdateAI is called, and think about how this could be used.</p></div>
</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">This is no special exercise, because I really want to encourage you guys to take matters into your own hand, and do some own stuff!</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/example.png" alt="Exercise" />
</td>
<td class="content">
<div class="title"><strong>Exercise 5</strong> - Do some own stuff</div>
<div class="ulist"><ul>
<li>
<p>
Pick another boss, create a basic script (look into Day 7)
</p>
</li>
<li>
<p>
Let this other boss display some basic texts like done today
</p>
</li>
<li>
<p>
Share the code you did with us all!
</p>
<div class="paragraph"><p>Best use format-patch styled output on <a href="http://paste2.org/new-paste">http://paste2.org/new-paste</a> and post your scripts in the forum. Take a look into the first week if you feel unsecure with creating patches and commits!</p></div>
</li>
</ul></div>
</td>
</tr></table>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2011-10-15 02:01:47 Mitteleurop√§ische Sommerzeit
</div>
</div>
</body>
</html>
